<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Studio ‚Äî Daily Focus Companion</title>
    <style>
        :root {
            --accent-color: #6366f1;
            --bg-color: #0f172a;
            --card-color: #1e293b;
            --text-primary: #f8fafc;
            --text-muted: #94a3b8;
            --btn-bg: #334155;
            --btn-text: #f8fafc;
            --btn-radius: 8px;
            --font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            --font-size-base: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            font-size: var(--font-size-base);
            background: var(--bg-color);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            background-image: 
                radial-gradient(ellipse at 20% 20%, color-mix(in srgb, var(--accent-color) 15%, transparent) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, color-mix(in srgb, var(--accent-color) 10%, transparent) 0%, transparent 50%),
                linear-gradient(180deg, var(--bg-color) 0%, color-mix(in srgb, var(--bg-color) 95%, black) 100%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        header h1 {
            font-size: clamp(1.75rem, 4vw, 2.5rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        header p {
            color: var(--text-muted);
            font-size: clamp(0.875rem, 2vw, 1rem);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 1.5rem;
        }

        .card {
            background: var(--card-color);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid color-mix(in srgb, var(--text-muted) 20%, transparent);
            box-shadow: 0 4px 24px color-mix(in srgb, black 30%, transparent);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid color-mix(in srgb, var(--text-muted) 20%, transparent);
        }

        .card-icon {
            width: 40px;
            height: 40px;
            background: color-mix(in srgb, var(--accent-color) 20%, transparent);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-color);
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        /* Clock Module */
        .clocks-card { grid-column: span 12; }
        @media (min-width: 960px) { .clocks-card { grid-column: span 6; } }
        @media (min-width: 1200px) { .clocks-card { grid-column: span 4; } }

        .clocks-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
        }

        .analog-clock-wrapper {
            position: relative;
        }

        #analogClock {
            display: block;
            max-width: 100%;
        }

        .digital-clock {
            text-align: center;
        }

        .digital-time {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 700;
            font-variant-numeric: tabular-nums;
            letter-spacing: 0.05em;
            color: var(--text-primary);
        }

        .digital-time .colon {
            opacity: 1;
            transition: opacity 0.2s;
        }

        .digital-time .colon.blink {
            opacity: 0.3;
        }

        .digital-date {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        /* Pomodoro Module */
        .pomodoro-card { grid-column: span 12; }
        @media (min-width: 960px) { .pomodoro-card { grid-column: span 6; } }
        @media (min-width: 1200px) { .pomodoro-card { grid-column: span 4; } }

        .pomodoro-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
        }

        .timer-ring-wrapper {
            position: relative;
            width: 200px;
            height: 200px;
        }

        .timer-ring {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                var(--accent-color) calc(var(--progress, 0) * 360deg),
                color-mix(in srgb, var(--text-muted) 20%, transparent) calc(var(--progress, 0) * 360deg)
            );
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .timer-inner {
            width: 85%;
            height: 85%;
            background: var(--card-color);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .timer-display {
            font-size: 2.5rem;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
        }

        .timer-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .timer-controls {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .pomodoro-status {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .round-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: color-mix(in srgb, var(--text-muted) 30%, transparent);
            transition: background 0.3s;
        }

        .round-indicator.completed {
            background: var(--accent-color);
        }

        .round-indicator.current {
            background: var(--accent-color);
            box-shadow: 0 0 8px var(--accent-color);
        }

        /* Insights Module */
        .insights-card { grid-column: span 12; }
        @media (min-width: 960px) { .insights-card { grid-column: span 6; } }
        @media (min-width: 1200px) { .insights-card { grid-column: span 4; } }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-item {
            background: color-mix(in srgb, var(--bg-color) 50%, transparent);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-color);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .session-history h4 {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
        }

        .session-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 150px;
            overflow-y: auto;
        }

        .session-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0.75rem;
            background: color-mix(in srgb, var(--bg-color) 50%, transparent);
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .session-time {
            color: var(--text-muted);
        }

        /* Motivation Module */
        .motivation-card { grid-column: span 12; }
        @media (min-width: 960px) { .motivation-card { grid-column: span 6; } }

        .quote-display {
            background: linear-gradient(135deg, 
                color-mix(in srgb, var(--accent-color) 10%, transparent),
                color-mix(in srgb, var(--accent-color) 5%, transparent)
            );
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .quote-text {
            font-size: 1.125rem;
            font-style: italic;
            line-height: 1.7;
        }

        .quote-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .saved-quotes {
            border-top: 1px solid color-mix(in srgb, var(--text-muted) 20%, transparent);
            padding-top: 1rem;
        }

        .saved-quotes h4 {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
        }

        .saved-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 150px;
            overflow-y: auto;
        }

        .saved-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: color-mix(in srgb, var(--bg-color) 50%, transparent);
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .saved-item-text {
            flex: 1;
            font-style: italic;
        }

        /* Theme Module */
        .theme-card { grid-column: span 12; }
        @media (min-width: 960px) { .theme-card { grid-column: span 6; } }

        .theme-mode-toggle {
            display: flex;
            background: color-mix(in srgb, var(--bg-color) 50%, transparent);
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 1.5rem;
        }

        .mode-btn {
            flex: 1;
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 6px;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .mode-btn[aria-selected="true"] {
            background: var(--accent-color);
            color: white;
        }

        .theme-controls {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 1rem;
        }

        .theme-control {
            display: flex;
            flex-direction: column;
            gap: 0.375rem;
        }

        .theme-control label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .color-input-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .color-input-wrapper input[type="color"] {
            width: 40px;
            height: 32px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: transparent;
        }

        .color-input-wrapper input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 2px;
        }

        .color-input-wrapper input[type="color"]::-webkit-color-swatch {
            border-radius: 4px;
            border: none;
        }

        .color-hex {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-family: monospace;
        }

        .theme-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        /* Settings Panel */
        .settings-card { grid-column: span 12; }

        .settings-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .settings-tab {
            padding: 0.5rem 1rem;
            border: 1px solid color-mix(in srgb, var(--text-muted) 30%, transparent);
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: var(--btn-radius);
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .settings-tab.active {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
        }

        .settings-panel {
            display: none;
        }

        .settings-panel.active {
            display: block;
        }

        .settings-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 0.375rem;
        }

        .setting-item label {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .setting-item input[type="number"],
        .setting-item select {
            padding: 0.5rem 0.75rem;
            background: color-mix(in srgb, var(--bg-color) 50%, transparent);
            border: 1px solid color-mix(in srgb, var(--text-muted) 30%, transparent);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .setting-item input[type="number"]:focus,
        .setting-item select:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .checkbox-item input {
            width: 18px;
            height: 18px;
            accent-color: var(--accent-color);
        }

        /* Buttons */
        .btn {
            padding: 0.625rem 1.25rem;
            background: var(--btn-bg);
            color: var(--btn-text);
            border: none;
            border-radius: var(--btn-radius);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            filter: brightness(1.1);
        }

        .btn:focus {
            outline: 2px solid var(--accent-color);
            outline-offset: 2px;
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
        }

        .btn-small {
            padding: 0.375rem 0.75rem;
            font-size: 0.8rem;
        }

        .btn-icon {
            padding: 0.5rem;
            width: 36px;
            height: 36px;
            justify-content: center;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        /* Utility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: color-mix(in srgb, var(--text-muted) 40%, transparent);
            border-radius: 3px;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--card-color);
            color: var(--text-primary);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            border: 1px solid color-mix(in srgb, var(--accent-color) 50%, transparent);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚ú¶ Focus Studio</h1>
            <p>Your daily focus companion ‚Äî clocks, timers & inspiration</p>
        </header>

        <main class="grid">
            <!-- Clocks Module -->
            <section class="card clocks-card" aria-labelledby="clocks-title">
                <div class="card-header">
                    <div class="card-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                    </div>
                    <h2 class="card-title" id="clocks-title">Clocks</h2>
                </div>
                <div class="clocks-container">
                    <div class="analog-clock-wrapper">
                        <canvas id="analogClock" width="180" height="180" aria-label="Analog clock" role="img"></canvas>
                    </div>
                    <div class="digital-clock" aria-live="polite" aria-atomic="true">
                        <div class="digital-time" id="digitalTime">00:00:00</div>
                        <div class="digital-date" id="digitalDate"></div>
                    </div>
                </div>
            </section>

            <!-- Pomodoro Module -->
            <section class="card pomodoro-card" aria-labelledby="pomodoro-title">
                <div class="card-header">
                    <div class="card-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                    </div>
                    <h2 class="card-title" id="pomodoro-title">Pomodoro Timer</h2>
                </div>
                <div class="pomodoro-container">
                    <div class="timer-ring-wrapper">
                        <div class="timer-ring" id="timerRing" style="--progress: 0">
                            <div class="timer-inner">
                                <div class="timer-display" id="timerDisplay" aria-live="polite">25:00</div>
                                <div class="timer-label" id="timerLabel">Work</div>
                            </div>
                        </div>
                    </div>
                    <div class="pomodoro-status" id="roundIndicators" aria-label="Pomodoro rounds"></div>
                    <div class="timer-controls">
                        <button class="btn btn-primary" id="timerToggle" aria-label="Start timer">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <polygon points="5 3 19 12 5 21 5 3"></polygon>
                            </svg>
                            Start
                        </button>
                        <button class="btn" id="timerReset" aria-label="Reset timer">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="1 4 1 10 7 10"></polyline>
                                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                            </svg>
                            Reset
                        </button>
                        <button class="btn" id="timerSkip" aria-label="Skip to next session">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5 4 15 12 5 20 5 4"></polygon>
                                <line x1="19" y1="5" x2="19" y2="19"></line>
                            </svg>
                            Skip
                        </button>
                    </div>
                </div>
            </section>

            <!-- Focus Insights -->
            <section class="card insights-card" aria-labelledby="insights-title">
                <div class="card-header">
                    <div class="card-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                    </div>
                    <h2 class="card-title" id="insights-title">Focus Insights</h2>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="statSessions">0</div>
                        <div class="stat-label">Sessions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statDeepWork">0m</div>
                        <div class="stat-label">Deep Work</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statLastSession">‚Äî</div>
                        <div class="stat-label">Last Session</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statStreak">0</div>
                        <div class="stat-label">Today's Streak</div>
                    </div>
                </div>
                <div class="session-history">
                    <h4>Recent Sessions</h4>
                    <div class="session-list" id="sessionList" aria-live="polite">
                        <div class="session-item" style="color: var(--text-muted); justify-content: center;">No sessions yet</div>
                    </div>
                </div>
            </section>

            <!-- Motivation Lab -->
            <section class="card motivation-card" aria-labelledby="motivation-title">
                <div class="card-header">
                    <div class="card-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>
                    </div>
                    <h2 class="card-title" id="motivation-title">Motivation Lab</h2>
                </div>
                <div class="quote-display">
                    <p class="quote-text" id="quoteText" aria-live="polite">"Loading inspiration..."</p>
                </div>
                <div class="quote-actions">
                    <button class="btn btn-small" id="shuffleQuote" aria-label="Get new quote">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="16 3 21 3 21 8"></polyline>
                            <line x1="4" y1="20" x2="21" y2="3"></line>
                            <polyline points="21 16 21 21 16 21"></polyline>
                            <line x1="15" y1="15" x2="21" y2="21"></line>
                            <line x1="4" y1="4" x2="9" y2="9"></line>
                        </svg>
                        Shuffle
                    </button>
                    <button class="btn btn-small" id="copyQuote" aria-label="Copy quote">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        Copy
                    </button>
                    <button class="btn btn-small btn-primary" id="saveQuote" aria-label="Save quote">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                        Save
                    </button>
                </div>
                <div class="saved-quotes">
                    <h4>Your Saved Affirmations</h4>
                    <div class="saved-list" id="savedQuotesList">
                        <div class="saved-item" style="color: var(--text-muted); justify-content: center;">No saved quotes yet</div>
                    </div>
                    <button class="btn btn-small btn-danger" id="clearQuotes" style="margin-top: 0.75rem; display: none;">Clear All</button>
                </div>
            </section>

            <!-- Theme Studio -->
            <section class="card theme-card" aria-labelledby="theme-title">
                <div class="card-header">
                    <div class="card-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </div>
                    <h2 class="card-title" id="theme-title">Theme Studio</h2>
                </div>
                <div class="theme-mode-toggle" role="tablist" aria-label="Theme mode">
                    <button class="mode-btn" role="tab" aria-selected="false" data-mode="light">‚òÄÔ∏è Light</button>
                    <button class="mode-btn" role="tab" aria-selected="true" data-mode="dark">üåô Dark</button>
                </div>
                <div class="theme-controls">
                    <div class="theme-control">
                        <label for="accentColor">Accent Color</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="accentColor" value="#6366f1">
                            <span class="color-hex" id="accentHex">#6366f1</span>
                        </div>
                    </div>
                    <div class="theme-control">
                        <label for="bgColor">Background</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="bgColor" value="#0f172a">
                            <span class="color-hex" id="bgHex">#0f172a</span>
                        </div>
                    </div>
                    <div class="theme-control">
                        <label for="cardColor">Card Surface</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="cardColor" value="#1e293b">
                            <span class="color-hex" id="cardHex">#1e293b</span>
                        </div>
                    </div>
                    <div class="theme-control">
                        <label for="textPrimary">Primary Text</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="textPrimary" value="#f8fafc">
                            <span class="color-hex" id="textPrimaryHex">#f8fafc</span>
                        </div>
                    </div>
                    <div class="theme-control">
                        <label for="textMuted">Muted Text</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="textMuted" value="#94a3b8">
                            <span class="color-hex" id="textMutedHex">#94a3b8</span>
                        </div>
                    </div>
                    <div class="theme-control">
                        <label for="btnBg">Button Background</label>
                        <div class="color-input-wrapper">
                            <input type="color" id="btnBg" value="#334155">
                            <span class="color-hex" id="btnBgHex">#334155</span>
                        </div>
                    </div>
                </div>
                <div class="theme-actions">
                    <button class="btn btn-small" id="exportSettings">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Export Settings
                    </button>
                    <button class="btn btn-small" id="importSettings">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        Import Settings
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none;">
                </div>
            </section>

            <!-- Settings Panel -->
            <section class="card settings-card" aria-labelledby="settings-title">
                <div class="card-header">
                    <div class="card-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
                        </svg>
                    </div>
                    <h2 class="card-title" id="settings-title">Settings</h2>
                </div>
                <div class="settings-tabs" role="tablist">
                    <button class="settings-tab active" data-panel="clock" role="tab" aria-selected="true">Clock</button>
                    <button class="settings-tab" data-panel="pomodoro" role="tab" aria-selected="false">Pomodoro</button>
                    <button class="settings-tab" data-panel="analog" role="tab" aria-selected="false">Analog Style</button>
                </div>

                <!-- Clock Settings -->
                <div class="settings-panel active" id="clockPanel">
                    <div class="settings-group">
                        <div class="setting-item">
                            <label for="timezoneSource">Timezone Source</label>
                            <select id="timezoneSource">
                                <option value="local">Local Time</option>
                                <option value="utc">UTC Offset</option>
                            </select>
                        </div>
                        <div class="setting-item" id="utcOffsetWrapper" style="display: none;">
                            <label for="utcOffset">UTC Offset (hours)</label>
                            <input type="number" id="utcOffset" min="-12" max="14" value="0">
                        </div>
                        <div class="setting-item">
                            <label for="timeFormat">Time Format</label>
                            <select id="timeFormat">
                                <option value="24">24-hour</option>
                                <option value="12">12-hour</option>
                            </select>
                        </div>
                        <label class="checkbox-item">
                            <input type="checkbox" id="showSeconds" checked>
                            <span>Show Seconds</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="blinkColon" checked>
                            <span>Blinking Colon</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="showDate" checked>
                            <span>Show Date</span>
                        </label>
                    </div>
                </div>

                <!-- Pomodoro Settings -->
                <div class="settings-panel" id="pomodoroPanel">
                    <div class="settings-group">
                        <div class="setting-item">
                            <label for="workDuration">Work Duration (min)</label>
                            <input type="number" id="workDuration" min="1" max="180" value="25">
                        </div>
                        <div class="setting-item">
                            <label for="shortBreak">Short Break (min)</label>
                            <input type="number" id="shortBreak" min="1" max="60" value="5">
                        </div>
                        <div class="setting-item">
                            <label for="longBreak">Long Break (min)</label>
                            <input type="number" id="longBreak" min="1" max="120" value="15">
                        </div>
                        <div class="setting-item">
                            <label for="roundsBeforeLong">Rounds Before Long Break</label>
                            <input type="number" id="roundsBeforeLong" min="1" max="12" value="4">
                        </div>
                        <label class="checkbox-item">
                            <input type="checkbox" id="autoStart">
                            <span>Auto-start Next Session</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="enableNotifications">
                            <span>Enable Notifications</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="enableSound" checked>
                            <span>Enable Sound</span>
                        </label>
                    </div>
                </div>

                <!-- Analog Clock Style -->
                <div class="settings-panel" id="analogPanel">
                    <div class="settings-group">
                        <label class="checkbox-item">
                            <input type="checkbox" id="showAnalogSeconds" checked>
                            <span>Show Second Hand</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="smoothSeconds" checked>
                            <span>Smooth Second Hand</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="showNumbers" checked>
                            <span>Show Numbers</span>
                        </label>
                        <div class="theme-control">
                            <label for="clockFaceColor">Clock Face</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="clockFaceColor" value="#1e293b">
                            </div>
                        </div>
                        <div class="theme-control">
                            <label for="clockTickColor">Tick Marks</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="clockTickColor" value="#94a3b8">
                            </div>
                        </div>
                        <div class="theme-control">
                            <label for="hourHandColor">Hour Hand</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="hourHandColor" value="#f8fafc">
                            </div>
                        </div>
                        <div class="theme-control">
                            <label for="minuteHandColor">Minute Hand</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="minuteHandColor" value="#f8fafc">
                            </div>
                        </div>
                        <div class="theme-control">
                            <label for="secondHandColor">Second Hand</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="secondHandColor" value="#6366f1">
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // =====================================================
        // STORAGE KEYS & DATA DEFINITIONS
        // =====================================================
        const STORAGE_KEYS = {
            THEME_VARS: 'tfs_theme_vars',
            THEME_MODE: 'tfs_theme_mode',
            CLOCK_SETTINGS: 'tfs_clock_settings',
            POMODORO_SETTINGS: 'tfs_pomodoro_settings',
            FOCUS_STATS: 'tfs_focus_stats',
            USER_QUOTES: 'tfs_user_quotes'
        };

        const baseQuotes = [
            "Focus is the bridge between dreaming and doing.",
            "Small steps lead to big achievements.",
            "Progress, not perfection, is the goal.",
            "Your attention is your most valuable resource.",
            "Deep work creates deep value.",
            "Distraction is the enemy of excellence.",
            "One task at a time, one moment at a time.",
            "Clarity comes from engagement, not thought.",
            "The present moment is your point of power.",
            "Consistency beats intensity over time.",
            "Start where you are, use what you have.",
            "Every focused minute compounds.",
            "Simplify, then execute.",
            "Momentum builds with each completed task.",
            "Your best work awaits your full attention."
        ];

        const fragments = {
            openers: ["Today", "This moment", "Your focus", "Right now", "In this hour", "Your attention", "This session", "Your energy", "Each minute", "Your dedication"],
            verbs: ["shapes", "builds", "transforms", "creates", "unlocks", "reveals", "strengthens", "cultivates", "nurtures", "ignites"],
            nouns: ["progress", "success", "momentum", "clarity", "growth", "potential", "results", "achievement", "breakthroughs", "excellence"],
            bridges: ["leads to", "creates space for", "unlocks", "paves the way for", "opens doors to", "sets the stage for", "enables", "fuels", "drives", "inspires"],
            adjectives: ["meaningful", "intentional", "steady", "powerful", "remarkable", "lasting", "genuine", "profound", "sustainable", "transformative"],
            values: ["consistency", "clarity", "purpose", "discipline", "commitment", "persistence", "resilience", "patience", "determination", "focus"],
            prompts: ["begin now", "take one step", "stay present", "embrace the process", "trust your rhythm", "keep moving forward", "honor your time", "commit fully", "breathe and begin", "lean into the work"],
            closers: ["You've got this.", "Keep going.", "Trust the process.", "Your effort matters.", "Stay the course.", "Believe in your progress.", "One step at a time.", "The work is worth it.", "You're building something great.", "This moment counts."]
        };

        const sentenceTemplates = [
            (f, r) => `${r(f.openers)} ${r(f.verbs)} ${r(f.adjectives)} ${r(f.nouns)}. ${r(f.closers)}`,
            (f, r) => `${r(f.values)} ${r(f.bridges)} ${r(f.adjectives)} ${r(f.nouns)}. ${r(f.prompts)}.`,
            (f, r) => `${r(f.openers)} ${r(f.bridges)} ${r(f.nouns)}. ${r(f.closers)}`,
            (f, r) => `Let ${r(f.values)} guide you. ${r(f.openers)} ${r(f.verbs)} ${r(f.nouns)}.`,
            (f, r) => `${r(f.prompts)}. ${r(f.values)} ${r(f.verbs)} ${r(f.adjectives)} ${r(f.nouns)}.`,
            (f, r) => `${r(f.openers)} is a chance to ${r(f.prompts)}. ${r(f.closers)}`,
            (f, r) => `When you ${r(f.prompts)}, ${r(f.nouns)} follows. ${r(f.closers)}`,
            (f, r) => `${r(f.adjectives)} ${r(f.nouns)} comes from ${r(f.values)}. ${r(f.prompts)}.`
        ];

        // =====================================================
        // UTILITY FUNCTIONS
        // =====================================================
        function mulberry32(seed) {
            return function() {
                let t = seed += 0x6D2B79F5;
                t = Math.imul(t ^ t >>> 15, t | 1);
                t ^= t + Math.imul(t ^ t >>> 7, t | 61);
                return ((t ^ t >>> 14) >>> 0) / 4294967296;
            };
        }

        function getFromStorage(key, defaultValue) {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch (e) {
                console.warn(`Error reading ${key} from storage:`, e);
                return defaultValue;
            }
        }

        function saveToStorage(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch (e) {
                console.warn(`Error saving ${key} to storage:`, e);
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function formatDuration(minutes) {
            if (minutes < 60) return `${minutes}m`;
            const hrs = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return mins > 0 ? `${hrs}h ${mins}m` : `${hrs}h`;
        }

        function formatRelativeTime(timestamp) {
            const diff = Date.now() - timestamp;
            const mins = Math.floor(diff / 60000);
            if (mins < 1) return 'Just now';
            if (mins < 60) return `${mins}m ago`;
            const hrs = Math.floor(mins / 60);
            if (hrs < 24) return `${hrs}h ago`;
            return `${Math.floor(hrs / 24)}d ago`;
        }

        function getLuminance(hex) {
            const rgb = parseInt(hex.slice(1), 16);
            const r = ((rgb >> 16) & 0xff) / 255;
            const g = ((rgb >> 8) & 0xff) / 255;
            const b = (rgb & 0xff) / 255;
            const toLinear = c => c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
            return 0.2126 * toLinear(r) + 0.7152 * toLinear(g) + 0.0722 * toLinear(b);
        }

        // =====================================================
        // THEME SYSTEM
        // =====================================================
        const themePresets = {
            dark: {
                '--accent-color': '#6366f1',
                '--bg-color': '#0f172a',
                '--card-color': '#1e293b',
                '--text-primary': '#f8fafc',
                '--text-muted': '#94a3b8',
                '--btn-bg': '#334155',
                '--btn-text': '#f8fafc'
            },
            light: {
                '--accent-color': '#6366f1',
                '--bg-color': '#f8fafc',
                '--card-color': '#ffffff',
                '--text-primary': '#0f172a',
                '--text-muted': '#64748b',
                '--btn-bg': '#e2e8f0',
                '--btn-text': '#0f172a'
            }
        };

        let currentThemeMode = getFromStorage(STORAGE_KEYS.THEME_MODE, 'dark');
        let themeVars = getFromStorage(STORAGE_KEYS.THEME_VARS, themePresets.dark);

        function applyTheme(vars) {
            Object.entries(vars).forEach(([prop, value]) => {
                document.documentElement.style.setProperty(prop, value);
            });
            updateThemeInputs(vars);
        }

        function updateThemeInputs(vars) {
            const mappings = {
                accentColor: '--accent-color',
                bgColor: '--bg-color',
                cardColor: '--card-color',
                textPrimary: '--text-primary',
                textMuted: '--text-muted',
                btnBg: '--btn-bg'
            };
            Object.entries(mappings).forEach(([inputId, cssVar]) => {
                const input = document.getElementById(inputId);
                const hex = document.getElementById(inputId + 'Hex');
                if (input && vars[cssVar]) {
                    input.value = vars[cssVar];
                    if (hex) hex.textContent = vars[cssVar];
                }
            });
        }

        function initTheme() {
            applyTheme(themeVars);
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.setAttribute('aria-selected', btn.dataset.mode === currentThemeMode);
            });
            
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentThemeMode = btn.dataset.mode;
                    themeVars = { ...themePresets[currentThemeMode] };
                    applyTheme(themeVars);
                    saveToStorage(STORAGE_KEYS.THEME_MODE, currentThemeMode);
                    saveToStorage(STORAGE_KEYS.THEME_VARS, themeVars);
                    document.querySelectorAll('.mode-btn').forEach(b => {
                        b.setAttribute('aria-selected', b.dataset.mode === currentThemeMode);
                    });
                });
            });

            const colorInputs = ['accentColor', 'bgColor', 'cardColor', 'textPrimary', 'textMuted', 'btnBg'];
            const cssVarMap = {
                accentColor: '--accent-color',
                bgColor: '--bg-color',
                cardColor: '--card-color',
                textPrimary: '--text-primary',
                textMuted: '--text-muted',
                btnBg: '--btn-bg'
            };

            colorInputs.forEach(inputId => {
                const input = document.getElementById(inputId);
                input.addEventListener('input', () => {
                    const cssVar = cssVarMap[inputId];
                    themeVars[cssVar] = input.value;
                    document.documentElement.style.setProperty(cssVar, input.value);
                    const hex = document.getElementById(inputId + 'Hex');
                    if (hex) hex.textContent = input.value;
                    saveToStorage(STORAGE_KEYS.THEME_VARS, themeVars);
                });
            });

            document.getElementById('exportSettings').addEventListener('click', exportSettings);
            document.getElementById('importSettings').addEventListener('click', () => {
                document.getElementById('importFile').click();
            });
            document.getElementById('importFile').addEventListener('change', importSettings);
        }

        function exportSettings() {
            const settings = {
                theme: themeVars,
                themeMode: currentThemeMode,
                clock: clockSettings,
                pomodoro: pomodoroSettings,
                quotes: userQuotes,
                analogStyle: analogClockStyle
            };
            const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'focus-studio-settings.json';
            a.click();
            URL.revokeObjectURL(url);
            showToast('Settings exported successfully!');
        }

        function importSettings(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const settings = JSON.parse(event.target.result);
                    if (settings.theme) {
                        themeVars = settings.theme;
                        applyTheme(themeVars);
                        saveToStorage(STORAGE_KEYS.THEME_VARS, themeVars);
                    }
                    if (settings.themeMode) {
                        currentThemeMode = settings.themeMode;
                        saveToStorage(STORAGE_KEYS.THEME_MODE, currentThemeMode);
                        document.querySelectorAll('.mode-btn').forEach(b => {
                            b.setAttribute('aria-selected', b.dataset.mode === currentThemeMode);
                        });
                    }
                    if (settings.clock) {
                        clockSettings = { ...clockSettings, ...settings.clock };
                        saveToStorage(STORAGE_KEYS.CLOCK_SETTINGS, clockSettings);
                        applyClockSettings();
                    }
                    if (settings.pomodoro) {
                        pomodoroSettings = { ...pomodoroSettings, ...settings.pomodoro };
                        saveToStorage(STORAGE_KEYS.POMODORO_SETTINGS, pomodoroSettings);
                        applyPomodoroSettings();
                    }
                    if (settings.quotes) {
                        userQuotes = settings.quotes;
                        saveToStorage(STORAGE_KEYS.USER_QUOTES, userQuotes);
                        renderSavedQuotes();
                    }
                    if (settings.analogStyle) {
                        analogClockStyle = { ...analogClockStyle, ...settings.analogStyle };
                        applyAnalogSettings();
                    }
                    showToast('Settings imported successfully!');
                } catch (err) {
                    showToast('Failed to import settings');
                    console.error(err);
                }
            };
            reader.readAsText(file);
            e.target.value = '';
        }

        // =====================================================
        // CLOCK SYSTEM
        // =====================================================
        let clockSettings = getFromStorage(STORAGE_KEYS.CLOCK_SETTINGS, {
            timezoneSource: 'local',
            utcOffset: 0,
            timeFormat: '24',
            showSeconds: true,
            blinkColon: true,
            showDate: true
        });

        let analogClockStyle = {
            showSeconds: true,
            smoothSeconds: true,
            showNumbers: true,
            faceColor: '#1e293b',
            tickColor: '#94a3b8',
            hourHandColor: '#f8fafc',
            minuteHandColor: '#f8fafc',
            secondHandColor: '#6366f1'
        };

        const analogCanvas = document.getElementById('analogClock');
        const analogCtx = analogCanvas.getContext('2d');
        let analogAnimationId;
        let colonVisible = true;

        function getAdjustedDate() {
            const now = new Date();
            if (clockSettings.timezoneSource === 'utc') {
                const utcTime = now.getTime() + now.getTimezoneOffset() * 60000;
                return new Date(utcTime + clockSettings.utcOffset * 3600000);
            }
            return now;
        }

        function setupAnalogClock() {
            const dpr = window.devicePixelRatio || 1;
            const size = 180;
            analogCanvas.width = size * dpr;
            analogCanvas.height = size * dpr;
            analogCanvas.style.width = size + 'px';
            analogCanvas.style.height = size + 'px';
            analogCtx.scale(dpr, dpr);
        }

        function drawAnalogClock() {
            const size = 180;
            const center = size / 2;
            const radius = center - 10;
            const date = getAdjustedDate();
            const hours = date.getHours();
            const minutes = date.getMinutes();
            const seconds = date.getSeconds();
            const ms = date.getMilliseconds();

            analogCtx.clearRect(0, 0, size, size);

            // Face
            analogCtx.beginPath();
            analogCtx.arc(center, center, radius, 0, Math.PI * 2);
            analogCtx.fillStyle = analogClockStyle.faceColor;
            analogCtx.fill();
            analogCtx.strokeStyle = analogClockStyle.tickColor;
            analogCtx.lineWidth = 2;
            analogCtx.stroke();

            // Tick marks
            for (let i = 0; i < 60; i++) {
                const angle = (i * 6 - 90) * Math.PI / 180;
                const isHour = i % 5 === 0;
                const innerR = isHour ? radius - 15 : radius - 8;
                const outerR = radius - 3;
                analogCtx.beginPath();
                analogCtx.moveTo(center + Math.cos(angle) * innerR, center + Math.sin(angle) * innerR);
                analogCtx.lineTo(center + Math.cos(angle) * outerR, center + Math.sin(angle) * outerR);
                analogCtx.strokeStyle = analogClockStyle.tickColor;
                analogCtx.lineWidth = isHour ? 2 : 1;
                analogCtx.stroke();
            }

            // Numbers
            if (analogClockStyle.showNumbers) {
                analogCtx.font = '12px sans-serif';
                analogCtx.fillStyle = analogClockStyle.tickColor;
                analogCtx.textAlign = 'center';
                analogCtx.textBaseline = 'middle';
                for (let i = 1; i <= 12; i++) {
                    const angle = (i * 30 - 90) * Math.PI / 180;
                    const numR = radius - 28;
                    analogCtx.fillText(i.toString(), center + Math.cos(angle) * numR, center + Math.sin(angle) * numR);
                }
            }

            // Hour hand
            const hourAngle = ((hours % 12) * 30 + minutes * 0.5 - 90) * Math.PI / 180;
            drawHand(center, hourAngle, radius * 0.5, 4, analogClockStyle.hourHandColor);

            // Minute hand
            const minuteAngle = (minutes * 6 + seconds * 0.1 - 90) * Math.PI / 180;
            drawHand(center, minuteAngle, radius * 0.7, 3, analogClockStyle.minuteHandColor);

            // Second hand
            if (analogClockStyle.showSeconds) {
                let secondAngle;
                if (analogClockStyle.smoothSeconds) {
                    secondAngle = ((seconds + ms / 1000) * 6 - 90) * Math.PI / 180;
                } else {
                    secondAngle = (seconds * 6 - 90) * Math.PI / 180;
                }
                drawHand(center, secondAngle, radius * 0.8, 1.5, analogClockStyle.secondHandColor);
            }

            // Center dot
            analogCtx.beginPath();
            analogCtx.arc(center, center, 4, 0, Math.PI * 2);
            analogCtx.fillStyle = analogClockStyle.secondHandColor;
            analogCtx.fill();

            analogAnimationId = requestAnimationFrame(drawAnalogClock);
        }

        function drawHand(center, angle, length, width, color) {
            analogCtx.beginPath();
            analogCtx.moveTo(center, center);
            analogCtx.lineTo(center + Math.cos(angle) * length, center + Math.sin(angle) * length);
            analogCtx.strokeStyle = color;
            analogCtx.lineWidth = width;
            analogCtx.lineCap = 'round';
            analogCtx.stroke();
        }

        function updateDigitalClock() {
            const date = getAdjustedDate();
            let hours = date.getHours();
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const seconds = date.getSeconds().toString().padStart(2, '0');
            let suffix = '';

            if (clockSettings.timeFormat === '12') {
                suffix = hours >= 12 ? ' PM' : ' AM';
                hours = hours % 12 || 12;
            }
            hours = hours.toString().padStart(2, '0');

            const colonClass = (clockSettings.blinkColon && !colonVisible) ? 'colon blink' : 'colon';
            let timeStr = `${hours}<span class="${colonClass}">:</span>${minutes}`;
            if (clockSettings.showSeconds) {
                timeStr += `<span class="${colonClass}">:</span>${seconds}`;
            }
            timeStr += suffix;

            document.getElementById('digitalTime').innerHTML = timeStr;

            if (clockSettings.showDate) {
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('digitalDate').textContent = date.toLocaleDateString(undefined, options);
                document.getElementById('digitalDate').style.display = 'block';
            } else {
                document.getElementById('digitalDate').style.display = 'none';
            }

            colonVisible = !colonVisible;
        }

        function applyClockSettings() {
            document.getElementById('timezoneSource').value = clockSettings.timezoneSource;
            document.getElementById('utcOffset').value = clockSettings.utcOffset;
            document.getElementById('timeFormat').value = clockSettings.timeFormat;
            document.getElementById('showSeconds').checked = clockSettings.showSeconds;
            document.getElementById('blinkColon').checked = clockSettings.blinkColon;
            document.getElementById('showDate').checked = clockSettings.showDate;
            document.getElementById('utcOffsetWrapper').style.display = 
                clockSettings.timezoneSource === 'utc' ? 'flex' : 'none';
        }

        function applyAnalogSettings() {
            document.getElementById('showAnalogSeconds').checked = analogClockStyle.showSeconds;
            document.getElementById('smoothSeconds').checked = analogClockStyle.smoothSeconds;
            document.getElementById('showNumbers').checked = analogClockStyle.showNumbers;
            document.getElementById('clockFaceColor').value = analogClockStyle.faceColor;
            document.getElementById('clockTickColor').value = analogClockStyle.tickColor;
            document.getElementById('hourHandColor').value = analogClockStyle.hourHandColor;
            document.getElementById('minuteHandColor').value = analogClockStyle.minuteHandColor;
            document.getElementById('secondHandColor').value = analogClockStyle.secondHandColor;
        }

        function initClockSettings() {
            applyClockSettings();
            applyAnalogSettings();

            document.getElementById('timezoneSource').addEventListener('change', (e) => {
                clockSettings.timezoneSource = e.target.value;
                document.getElementById('utcOffsetWrapper').style.display = 
                    e.target.value === 'utc' ? 'flex' : 'none';
                saveToStorage(STORAGE_KEYS.CLOCK_SETTINGS, clockSettings);
            });

            document.getElementById('utcOffset').addEventListener('change', (e) => {
                clockSettings.utcOffset = parseInt(e.target.value) || 0;
                saveToStorage(STORAGE_KEYS.CLOCK_SETTINGS, clockSettings);
            });

            document.getElementById('timeFormat').addEventListener('change', (e) => {
                clockSettings.timeFormat = e.target.value;
                saveToStorage(STORAGE_KEYS.CLOCK_SETTINGS, clockSettings);
            });

            document.getElementById('showSeconds').addEventListener('change', (e) => {
                clockSettings.showSeconds = e.target.checked;
                saveToStorage(STORAGE_KEYS.CLOCK_SETTINGS, clockSettings);
            });

            document.getElementById('blinkColon').addEventListener('change', (e) => {
                clockSettings.blinkColon = e.target.checked;
                saveToStorage(STORAGE_KEYS.CLOCK_SETTINGS, clockSettings);
            });

            document.getElementById('showDate').addEventListener('change', (e) => {
                clockSettings.showDate = e.target.checked;
                saveToStorage(STORAGE_KEYS.CLOCK_SETTINGS, clockSettings);
            });

            // Analog settings
            document.getElementById('showAnalogSeconds').addEventListener('change', (e) => {
                analogClockStyle.showSeconds = e.target.checked;
            });

            document.getElementById('smoothSeconds').addEventListener('change', (e) => {
                analogClockStyle.smoothSeconds = e.target.checked;
            });

            document.getElementById('showNumbers').addEventListener('change', (e) => {
                analogClockStyle.showNumbers = e.target.checked;
            });

            const analogColorInputs = ['clockFaceColor', 'clockTickColor', 'hourHandColor', 'minuteHandColor', 'secondHandColor'];
            const analogColorMap = {
                clockFaceColor: 'faceColor',
                clockTickColor: 'tickColor',
                hourHandColor: 'hourHandColor',
                minuteHandColor: 'minuteHandColor',
                secondHandColor: 'secondHandColor'
            };

            analogColorInputs.forEach(inputId => {
                document.getElementById(inputId).addEventListener('input', (e) => {
                    analogClockStyle[analogColorMap[inputId]] = e.target.value;
                });
            });
        }

        // =====================================================
        // POMODORO TIMER
        // =====================================================
        let pomodoroSettings = getFromStorage(STORAGE_KEYS.POMODORO_SETTINGS, {
            workDuration: 25,
            shortBreak: 5,
            longBreak: 15,
            roundsBeforeLong: 4,
            autoStart: false,
            enableNotifications: false,
            enableSound: true
        });

        let focusStats = getFromStorage(STORAGE_KEYS.FOCUS_STATS, {
            sessions: 0,
            totalMinutes: 0,
            lastSession: null,
            history: [],
            date: new Date().toDateString()
        });

        let timerState = {
            isRunning: false,
            isPaused: false,
            currentPhase: 'work', // 'work', 'shortBreak', 'longBreak'
            currentRound: 1,
            timeRemaining: pomodoroSettings.workDuration * 60,
            totalTime: pomodoroSettings.workDuration * 60,
            intervalId: null
        };

        let audioContext = null;

        function checkAndResetStats() {
            const today = new Date().toDateString();
            if (focusStats.date !== today) {
                focusStats = {
                    sessions: 0,
                    totalMinutes: 0,
                    lastSession: null,
                    history: [],
                    date: today
                };
                saveToStorage(STORAGE_KEYS.FOCUS_STATS, focusStats);
            }
        }

        function updateTimerDisplay() {
            const mins = Math.floor(timerState.timeRemaining / 60);
            const secs = timerState.timeRemaining % 60;
            document.getElementById('timerDisplay').textContent = 
                `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

            const progress = 1 - (timerState.timeRemaining / timerState.totalTime);
            document.getElementById('timerRing').style.setProperty('--progress', progress);

            const labels = { work: 'Work', shortBreak: 'Short Break', longBreak: 'Long Break' };
            document.getElementById('timerLabel').textContent = labels[timerState.currentPhase];
        }

        function updateRoundIndicators() {
            const container = document.getElementById('roundIndicators');
            container.innerHTML = '';
            for (let i = 1; i <= pomodoroSettings.roundsBeforeLong; i++) {
                const dot = document.createElement('div');
                dot.className = 'round-indicator';
                if (i < timerState.currentRound) {
                    dot.classList.add('completed');
                } else if (i === timerState.currentRound && timerState.currentPhase === 'work') {
                    dot.classList.add('current');
                }
                container.appendChild(dot);
            }
        }

        function updateStatsDisplay() {
            checkAndResetStats();
            document.getElementById('statSessions').textContent = focusStats.sessions;
            document.getElementById('statDeepWork').textContent = formatDuration(focusStats.totalMinutes);
            document.getElementById('statLastSession').textContent = 
                focusStats.lastSession ? formatRelativeTime(focusStats.lastSession) : '‚Äî';
            document.getElementById('statStreak').textContent = focusStats.sessions;

            const historyContainer = document.getElementById('sessionList');
            if (focusStats.history.length === 0) {
                historyContainer.innerHTML = '<div class="session-item" style="color: var(--text-muted); justify-content: center;">No sessions yet</div>';
            } else {
                historyContainer.innerHTML = focusStats.history.slice(-7).reverse().map(session => {
                    const time = new Date(session.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    return `<div class="session-item">
                        <span>${session.duration}min session</span>
                        <span class="session-time">${time}</span>
                    </div>`;
                }).join('');
            }
        }

        function playNotificationSound() {
            if (!pomodoroSettings.enableSound) return;
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                const frequencies = [880, 660, 990];
                frequencies.forEach((freq, i) => {
                    setTimeout(() => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        oscillator.frequency.value = freq;
                        oscillator.type = 'sine';
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.3);
                    }, i * 200);
                });
            } catch (e) {
                console.warn('Audio playback failed:', e);
            }
        }

        function showNotification(title, body) {
            if (!pomodoroSettings.enableNotifications) return;
            if (Notification.permission === 'granted') {
                new Notification(title, { body, icon: '‚è±Ô∏è' });
            }
        }

        function completeSession() {
            playNotificationSound();

            if (timerState.currentPhase === 'work') {
                const duration = pomodoroSettings.workDuration;
                focusStats.sessions++;
                focusStats.totalMinutes += duration;
                focusStats.lastSession = Date.now();
                focusStats.history.push({
                    timestamp: Date.now(),
                    duration: duration
                });
                if (focusStats.history.length > 50) {
                    focusStats.history = focusStats.history.slice(-50);
                }
                saveToStorage(STORAGE_KEYS.FOCUS_STATS, focusStats);
                updateStatsDisplay();

                showNotification('Work Session Complete!', 'Time for a break. Great job!');

                if (timerState.currentRound >= pomodoroSettings.roundsBeforeLong) {
                    timerState.currentPhase = 'longBreak';
                    timerState.totalTime = pomodoroSettings.longBreak * 60;
                    timerState.currentRound = 1;
                } else {
                    timerState.currentPhase = 'shortBreak';
                    timerState.totalTime = pomodoroSettings.shortBreak * 60;
                }
            } else {
                showNotification('Break Over!', 'Time to focus. You got this!');
                timerState.currentPhase = 'work';
                timerState.totalTime = pomodoroSettings.workDuration * 60;
                if (timerState.currentPhase === 'work') {
                    timerState.currentRound++;
                }
            }

            timerState.timeRemaining = timerState.totalTime;
            updateTimerDisplay();
            updateRoundIndicators();

            if (pomodoroSettings.autoStart) {
                startTimer();
            } else {
                stopTimer();
            }
        }

        function startTimer() {
            if (timerState.intervalId) return;
            timerState.isRunning = true;
            timerState.isPaused = false;
            updateToggleButton();

            timerState.intervalId = setInterval(() => {
                timerState.timeRemaining--;
                updateTimerDisplay();

                if (timerState.timeRemaining <= 0) {
                    clearInterval(timerState.intervalId);
                    timerState.intervalId = null;
                    completeSession();
                }
            }, 1000);
        }

        function stopTimer() {
            if (timerState.intervalId) {
                clearInterval(timerState.intervalId);
                timerState.intervalId = null;
            }
            timerState.isRunning = false;
            timerState.isPaused = true;
            updateToggleButton();
        }

        function resetTimer() {
            stopTimer();
            timerState.currentPhase = 'work';
            timerState.currentRound = 1;
            timerState.totalTime = pomodoroSettings.workDuration * 60;
            timerState.timeRemaining = timerState.totalTime;
            timerState.isPaused = false;
            updateTimerDisplay();
            updateRoundIndicators();
            updateToggleButton();
        }

        function skipSession() {
            stopTimer();
            completeSession();
        }

        function updateToggleButton() {
            const btn = document.getElementById('timerToggle');
            if (timerState.isRunning) {
                btn.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <rect x="6" y="4" width="4" height="16"></rect>
                    <rect x="14" y="4" width="4" height="16"></rect>
                </svg> Pause`;
            } else {
                btn.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                </svg> Start`;
            }
        }

        function applyPomodoroSettings() {
            document.getElementById('workDuration').value = pomodoroSettings.workDuration;
            document.getElementById('shortBreak').value = pomodoroSettings.shortBreak;
            document.getElementById('longBreak').value = pomodoroSettings.longBreak;
            document.getElementById('roundsBeforeLong').value = pomodoroSettings.roundsBeforeLong;
            document.getElementById('autoStart').checked = pomodoroSettings.autoStart;
            document.getElementById('enableNotifications').checked = pomodoroSettings.enableNotifications;
            document.getElementById('enableSound').checked = pomodoroSettings.enableSound;
        }

        function initPomodoro() {
            applyPomodoroSettings();
            updateTimerDisplay();
            updateRoundIndicators();
            updateStatsDisplay();

            document.getElementById('timerToggle').addEventListener('click', () => {
                if (timerState.isRunning) {
                    stopTimer();
                } else {
                    startTimer();
                }
            });

            document.getElementById('timerReset').addEventListener('click', resetTimer);
            document.getElementById('timerSkip').addEventListener('click', skipSession);

            // Keyboard shortcut
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space' && e.target.tagName !== 'INPUT' && e.target.tagName !== 'SELECT') {
                    e.preventDefault();
                    if (timerState.isRunning) {
                        stopTimer();
                    } else {
                        startTimer();
                    }
                }
            });

            // Settings listeners
            document.getElementById('workDuration').addEventListener('change', (e) => {
                pomodoroSettings.workDuration = Math.max(1, Math.min(180, parseInt(e.target.value) || 25));
                e.target.value = pomodoroSettings.workDuration;
                saveToStorage(STORAGE_KEYS.POMODORO_SETTINGS, pomodoroSettings);
                if (!timerState.isRunning && timerState.currentPhase === 'work') {
                    timerState.totalTime = pomodoroSettings.workDuration * 60;
                    timerState.timeRemaining = timerState.totalTime;
                    updateTimerDisplay();
                }
            });

            document.getElementById('shortBreak').addEventListener('change', (e) => {
                pomodoroSettings.shortBreak = Math.max(1, Math.min(60, parseInt(e.target.value) || 5));
                e.target.value = pomodoroSettings.shortBreak;
                saveToStorage(STORAGE_KEYS.POMODORO_SETTINGS, pomodoroSettings);
            });

            document.getElementById('longBreak').addEventListener('change', (e) => {
                pomodoroSettings.longBreak = Math.max(1, Math.min(120, parseInt(e.target.value) || 15));
                e.target.value = pomodoroSettings.longBreak;
                saveToStorage(STORAGE_KEYS.POMODORO_SETTINGS, pomodoroSettings);
            });

            document.getElementById('roundsBeforeLong').addEventListener('change', (e) => {
                pomodoroSettings.roundsBeforeLong = Math.max(1, Math.min(12, parseInt(e.target.value) || 4));
                e.target.value = pomodoroSettings.roundsBeforeLong;
                saveToStorage(STORAGE_KEYS.POMODORO_SETTINGS, pomodoroSettings);
                updateRoundIndicators();
            });

            document.getElementById('autoStart').addEventListener('change', (e) => {
                pomodoroSettings.autoStart = e.target.checked;
                saveToStorage(STORAGE_KEYS.POMODORO_SETTINGS, pomodoroSettings);
            });

            document.getElementById('enableNotifications').addEventListener('change', (e) => {
                pomodoroSettings.enableNotifications = e.target.checked;
                if (e.target.checked && Notification.permission === 'default') {
                    Notification.requestPermission();
                }
                saveToStorage(STORAGE_KEYS.POMODORO_SETTINGS, pomodoroSettings);
            });

            document.getElementById('enableSound').addEventListener('change', (e) => {
                pomodoroSettings.enableSound = e.target.checked;
                saveToStorage(STORAGE_KEYS.POMODORO_SETTINGS, pomodoroSettings);
            });
        }

        // =====================================================
        // MOTIVATION LAB
        // =====================================================
        let userQuotes = getFromStorage(STORAGE_KEYS.USER_QUOTES, []);
        let currentQuote = '';
        let lastQuoteHour = -1;

        function generateQuote() {
            const now = new Date();
            const hourSeed = now.getFullYear() * 1000000 + (now.getMonth() + 1) * 10000 + now.getDate() * 100 + now.getHours();
            const rng = mulberry32(hourSeed);

            // 15% chance to show user quote if available
            if (userQuotes.length > 0 && rng() < 0.15) {
                const idx = Math.floor(rng() * userQuotes.length);
                return userQuotes[idx];
            }

            // 40% chance for base quotes, 60% for generated
            if (rng() < 0.4) {
                const idx = Math.floor(rng() * baseQuotes.length);
                return baseQuotes[idx];
            }

            // Generate procedural quote
            const pick = (arr) => arr[Math.floor(rng() * arr.length)];
            const templateIdx = Math.floor(rng() * sentenceTemplates.length);
            return sentenceTemplates[templateIdx](fragments, pick);
        }

        function updateQuote(force = false) {
            const currentHour = new Date().getHours();
            if (force || currentHour !== lastQuoteHour) {
                currentQuote = generateQuote();
                document.getElementById('quoteText').textContent = `"${currentQuote}"`;
                lastQuoteHour = currentHour;
            }
        }

        function shuffleQuote() {
            // Use random seed for shuffle
            const rng = mulberry32(Date.now());
            const pick = (arr) => arr[Math.floor(rng() * arr.length)];

            if (userQuotes.length > 0 && rng() < 0.15) {
                currentQuote = userQuotes[Math.floor(rng() * userQuotes.length)];
            } else if (rng() < 0.4) {
                currentQuote = baseQuotes[Math.floor(rng() * baseQuotes.length)];
            } else {
                const templateIdx = Math.floor(rng() * sentenceTemplates.length);
                currentQuote = sentenceTemplates[templateIdx](fragments, pick);
            }
            document.getElementById('quoteText').textContent = `"${currentQuote}"`;
        }

        function copyQuote() {
            navigator.clipboard.writeText(currentQuote).then(() => {
                showToast('Quote copied to clipboard!');
            }).catch(() => {
                showToast('Failed to copy quote');
            });
        }

        function saveQuote() {
            if (currentQuote && !userQuotes.includes(currentQuote)) {
                userQuotes.push(currentQuote);
                saveToStorage(STORAGE_KEYS.USER_QUOTES, userQuotes);
                renderSavedQuotes();
                showToast('Quote saved!');
            } else if (userQuotes.includes(currentQuote)) {
                showToast('Quote already saved');
            }
        }

        function removeQuote(index) {
            userQuotes.splice(index, 1);
            saveToStorage(STORAGE_KEYS.USER_QUOTES, userQuotes);
            renderSavedQuotes();
        }

        function clearAllQuotes() {
            userQuotes = [];
            saveToStorage(STORAGE_KEYS.USER_QUOTES, userQuotes);
            renderSavedQuotes();
            showToast('All quotes cleared');
        }

        function renderSavedQuotes() {
            const container = document.getElementById('savedQuotesList');
            const clearBtn = document.getElementById('clearQuotes');

            if (userQuotes.length === 0) {
                container.innerHTML = '<div class="saved-item" style="color: var(--text-muted); justify-content: center;">No saved quotes yet</div>';
                clearBtn.style.display = 'none';
            } else {
                container.innerHTML = userQuotes.map((quote, i) => `
                    <div class="saved-item">
                        <span class="saved-item-text">"${quote}"</span>
                        <button class="btn btn-icon btn-small" onclick="removeQuote(${i})" aria-label="Remove quote">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                `).join('');
                clearBtn.style.display = 'inline-flex';
            }
        }

        function initMotivation() {
            updateQuote();
            renderSavedQuotes();

            document.getElementById('shuffleQuote').addEventListener('click', shuffleQuote);
            document.getElementById('copyQuote').addEventListener('click', copyQuote);
            document.getElementById('saveQuote').addEventListener('click', saveQuote);
            document.getElementById('clearQuotes').addEventListener('click', clearAllQuotes);

            // Update quote every minute to catch hour changes
            setInterval(() => updateQuote(), 60000);
        }

        // =====================================================
        // SETTINGS TABS
        // =====================================================
        function initSettingsTabs() {
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.settings-tab').forEach(t => {
                        t.classList.remove('active');
                        t.setAttribute('aria-selected', 'false');
                    });
                    document.querySelectorAll('.settings-panel').forEach(p => p.classList.remove('active'));

                    tab.classList.add('active');
                    tab.setAttribute('aria-selected', 'true');
                    document.getElementById(tab.dataset.panel + 'Panel').classList.add('active');
                });
            });
        }

        // =====================================================
        // INITIALIZATION
        // =====================================================
        function init() {
            initTheme();
            setupAnalogClock();
            drawAnalogClock();
            initClockSettings();
            setInterval(updateDigitalClock, 500);
            updateDigitalClock();
            initPomodoro();
            initMotivation();
            initSettingsTabs();
            
            // Update stats display periodically for relative times
            setInterval(updateStatsDisplay, 60000);
        }

        // Make removeQuote available globally
        window.removeQuote = removeQuote;

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>